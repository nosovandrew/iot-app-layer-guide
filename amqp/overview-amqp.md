[:arrow_left: На главную](/README.md)

# AMQP (Advansed Message Queuing Protocol)

Протокол обмена данными между устройствами сети с использованием центрального узла (AMQP-брокера).

[Демо](amqp/demo/README.md)

## Основные аспекты протокола на примере реализации [RabbitMQ](https://www.rabbitmq.com)

Общая структура системы под упарвлением протокола AMQP представлена на рисунке ниже ([источник изображения](https://www.cloudamqp.com/blog/part1-rabbitmq-for-beginners-what-is-rabbitmq.html))

![AMQP system structure](../media/amqp/sys-structure.png)

**Основные элементы** представлены следующим набором:
* брокер:
  * точка обмена (англ. exchange) — сюда попадают входящие сообщения, которые должны быть распределены в одну или несколько очередей, в соответствии с установленными привязками (англ. binding);
  * очередь (англ. queue) — контейнер, который хранит ссылки на приходящие сообщения и отдает копии этих сообщений потребителям (англ. consumers);
  * привязка (англ. binding) — указатель, направляющий сообщение в нужную очередь, очередь и обменник могут быть связаны несколькими привязками;
* клиенты производитель/потребитель (англ. producer/consumer) — конечные точки системы, которые отправляют и принимают данные.

Краткий **алгоритм работы** протокола:
1. Издатель отправляет сообщение определенной точке обмена, которая, получив сообщение, маршрутизирует его в одну или несколько очередей в соответствии с привязками.
2. Очередь хранит ссылку на полученное сообщение, оригинал сообщения хранится в отдельно выделенной памяти.
3. Когда потребитель готов получить сообщение из очереди, то создается и отправляется копия сообщения.
4. Потребитель получает сообщение и отправляет брокеру подтверждение.
5. Получив подтверждение, брокер удаляет сообщение и все его копии.

Клиенты системы могут быть реализованы на основе AMQP, также имеется поддержка протокола MQTT (по крайней мере в брокера от RabbitMQ).

Основным элементом AMQP-сети является брокер, который оснащен широким набором возможностей для конфгурации (распределение сообщений, резервирование, фильтрация и т.д.) под различные параметры и требования сети. Больше информации по настройке и использованию RabbitMQ-брокера (одина из самых популярный реализаций AMQP-брокера) можно найти в [документации RabbitMQ](https://www.rabbitmq.com/documentation.html), а также сущности брокера сжато описаны в [данной статье](https://medium.com/@samuelowino43/advanced-message-queueing-protocol-ampq-0-9-1-617209d2d6ec).

Полезными при досканальном изучении работы протокола будут:
* [спецификация AMQP 0-9-1 (наиболее используемая версия)](https://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf);
* [спецификация AMQP v0.1 (самая свежая версия)](https://www.amqp.org/sites/amqp.org/files/amqp.pdf).

## Наиболее значимые характеристики протокола

|   Характеристика  |   Описание    |
|----               |----
|   Адаптация к IoT (балл)    |   3/4 |
|   Транспортный Уровень    |   TCP, либо более новый SCTP (многопоточность, защита от DDoS атак, синхронное соединение между двумя хостами по нескольким физическим каналам) |
|   Кодирование    |    Бинарный    |
|   Заголовок    |    8 байт    |
|   Архитектура    |    Client/Broker (централизованная)    |
|   Модель взаимодействия    |    Pub/Sub    |
|   Участок в сети (наибольшая эффективность)    |    Server-to-Server    |
|   Надежность    |    Аналог QoS 0, 1    |
|   Безопасность    |    TLS/SSL-шифрование, аутентификация SASL    |

Исчерпывающий **список реализаций** брокера, клиентов, дополниткльных инструментов представлен в ресурсе [Awesome AMQP](https://github.com/xinchen10/awesome-amqp).

**Процесс разработка и запуск системы на базе AMQP** достаточно просты, особенно, если использовать готовый AMQP-брокер, расположенный в облаке с подключенной панелью управления. Запуск системы существенно усложняется, если есть необходимость ручной настройки брокера (специфика конкретной реализации, условия и требования проекта), поскольку данный процесс является достаточно объемным и ответсвенным (есть вероятность оставить бреши в системе безопасности).

Большинство реализаций обладают очень качественной **документацией**, а также широким сообществом разработчиков, что, безусловно, упрощает все процессы по работе с протоколом.

[:arrow_left: На главную](/README.md)