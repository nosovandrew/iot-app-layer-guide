[:arrow_left: На главную](/README.md)

# Выбор оптимального решения

## Основные "за" и "против"

|   | MQTT | AMQP | CoAP | HTTP | OPC UA | DDS | XMPP |
|---|------|------|------|------|--------|-----|------|
| **+** |   легкость*   |   широкий функционал и набор настроек брокера   |   устройства с ограниченными ресурсами   |   совместимость с АО и ПО   |    широкий функционал    |   распределенная структура (нет центра)  |   безопасность   |
| **+** |   совместимость с АО и ПО   |   безопасность   |   распределенная структура (нет центра)   |   реализации*   |    унифицированная архитектура*    |   устройства с ограниченными ресурсами  |   реализации сервера   |
| **+** |   реализации*   |   реализации*   |   RESTful   |   RESTful   |        |   надежность  |   модель мессенджера   |
|  |  |  |  |  |  |  |  |
| **-** |   безопасность   |   централизованная структура   |   нет pub/sub   |   слишком тяжелый для IoT-устройств   |    сложность реализации    |  сложное устройство   |   тяжелый для IoT-устройств   |
| **-** |   централизованная структура   |   сложность настройки   |   надежность   |   нет асинхронности   |    тяжелый для IoT-устройств    |   реализации  |   документация   |
| **-** |   узкий выбор конфигураций (брокер) и отсутсвие определенного формата сообщений   |   устройства с ограниченными ресурсами   |      |      |    требовательный к доп. окружению    |  требование к доп. окружению   |    поддержка  |

Расшифровка*:
* легкость — простое устройство протокола, возможность работы с устройствами, ограниченными в ресурсах, низкие требования к характеристикам оборудования и к программному окружению, низкое потребление энергии;
* реализации — существование различных реализаций протокола (библиотеки, готовые решения, облачные сервисы), а также поддержка совместимости с другими протоколами;
* документация — общий показатель качества документации к реализациям протокола (наличие, описание функционала, демонстрационные примеры, КРАТКОСТЬ);
* унифицированная архитектура — интеграция нескольких приложений в единую систему.

## Рекомендация по протоколам

#### MQTT (Message Queuing Telemetry Transport)

Это облегченный протокол передачи данных IoT. Он поддерживает модель обмена сообщениями издатель-подписчик и обеспечивает простой поток данных между различными устройствами.

Главное преимущество MQTT — его архитектура. Его структура невероятно проста и легка, поэтому он может обеспечивать низкое энергопотребление устройств. MQTT работает поверх протокола TCP/IP. Для еще более низкого потрбления ресурсов разработан протокол MQTT-SN (поверх UDP), который предназначен для WSN (wireless sensor network).

Протоколы данных IoT (в том числе MQTT) были разработаны для борьбы с ненадежными сетями связи. Это стало потребностью в мире Интернета вещей из-за увеличения количества небольших, дешевых и маломощных объектов, появившихся в сети за последние несколько лет.

Несмотря на широкую адаптацию MQTT, особенно в качестве стандарта IoT для промышленных приложений, он не поддерживает определенное представление данных и режим управления устройствами. В результате реализация возможностей управления данными и устройствами полностью зависит от платформы или поставщика.

Протокол является идеальным рещением, если необходимо обеспечить макстимальную простоту и легкость конечной системы. Это настоящий прмимер минимализма в области IoT-систем.

#### CoAP (Constrained Application Protocol)

Разработан для удовлетворения потребностей систем Интернета вещей на основе HTTP (протокол передачи гипертекста, основа передачи данных во всемирной паутине).

Хотя существующая структура Интернета находится в свободном доступе и может использоваться любым устройством IoT, часто она слишком тяжелая и энергоемкая для большинства приложений IoT. Это привело к тому, что многие в сообществе Интернета вещей отвергли HTTP как протокол, не подходящий для Интернета вещей.

CoAP устранил это ограничение, переведя модель HTTP на использование в ограниченных устройствах и сетевых средах. Он имеет невероятно низкие накладные расходы, прост в использовании и может включать поддержку многоадресной рассылки.

Поэтому он идеально подходит для использования в устройствах с ограниченными ресурсами, таких как микроконтроллеры Интернета вещей или узлы WSN. Он традиционно используется в приложениях, где необходимо поддержать RESTful, а HTTP слишком тяжелый для поставленных задач.

#### AMQP (Advanced Message Queuing Protocol)

Расширенный протокол очереди сообщений (AMQP) - это открытый стандартный протокол прикладного уровня, используемый для транзакционных сообщений между серверами.

Основные функции этого протокола Интернета вещей заключаются в следующем:

* получение и размещение сообщений в очередях;
* хранение сообщений;
* установление связи между компонентами.

Обладая уровнем безопасности и надежности, он чаще всего используется в условиях, когда требуется серверная аналитическая среда, например в банковской сфере. Однако в других местах он широко не используется. Из-за своего веса он не очень хорошо подходит для сенсорных устройств Интернета вещей с ограниченной памятью. В результате его использование все еще весьма ограничено в мире Интернета вещей.

Адаптация под устройства с ограниченными ресурсами достигается за счет поддержки взаимодейсвтия с протоколом MQTT, который отвечет за WSN-устройства, а брокером управляет также AMQP (AMQP+MQTT).

#### HTTP (HyperText Transfer Protocol)

Протокол HTTP не является предпочтительным в качестве стандарта IoT из-за его стоимости, времени автономной работы, огромного энергопотребления и проблем с весом.

При этом он все еще используется в некоторых отраслях благодарая глобальной поддержке, а также возможности работать с большими объемами данных. Например, производство и трехмерная печать полагаются на протокол HTTP из-за того, что он может публиковать большие объемы данных. Это позволяет подключать ПК к трехмерным принтерам в сети и печатать трехмерные объекты.

#### DDS (Data Distribution Service)

Масштабируемый протокол Интернета вещей, обеспечивающий высококачественную связь. DDS работает по модели издатель-подписчик, поверх UDP или TCP/IP, не требует центрального узла (боркера) и предоставляет широкий набор настроек надежности. 

Его можно развернуть в нескольких настройках, от облака до очень маленьких устройств. Это делает его идеальным для систем реального времени и встроенных систем. Более того, в отличие от MQTT, протокол DDS позволяет осуществлять совместный обмен данными независимо от аппаратной и программной платформы.

Протокол подойдет для распредленных WSN, требующих повышенного уровня гибкости настроек и надежности сети.

#### OPC UA (Open Platform Communication Unified Architecture)

Это целая архитектура, для которой прикладной протокол передачи данных является лишь частью. Коммуникация основана на модели клиент-сервер (в настоящее время разрабатывается модель издатель-подписчик), где сервер предоставляет набор стандартных сервисов для навигации по доступному объекту, чтения и записи данных, вызова методов или подписки на изменение данных.

Основная цель - обеспечить взаимодействие между приложениями от разных поставщиков с помощью создания метамодели того, как сделать информацию доступной, путем определения стандартных сервисов для доступа к информации и определения различных транспортных протоколов и кодировок данных для вызова сервиса.

Допустим, нам необходимо получать данные и записывать их в перменную внутри ПЛК. В таком случае нам необходима клиентская программа, которая, допустим, будет подписана на тему в брокере (в случае использования MQTT и AMQP) и иметь доступ к ПЛК для записи данных. В случае использования протоколов MQTT, CoAP, XMPP нам необходимо создать уникальную клиентскую программу под каждый специфичный случай (разные производители ПЛК, тип и структура сообщений). OPC UA в этом случае позволяет объединить несколько приложений в единую систему.

#### XMPP  (eXtensible Messaging and Presence Protocol)

Протокол изначально разработан под реализацию различных чат-приложений и мессенджеров, поэтому он хорошо может подойти для IoT-систем, подразумевающих взаимодействие пользователя и устройств по подобию общения в мессенджере.

Из положительных качеств можно отметить четко определенную структуру передаваемых сообщений, наличие большого количества реализаций (библиотеки, готовые решения, облачные сервисы), безопасность. Однако протокол достаточно тяжелый для WSN-устройств, что заставяет идти на дополнительные меры, напрмер, интеграцию с MQTT.

## Рекомендация по основным параметрам

* Безопасность
  * AMQP;
* Надежность
  * MQTT;
  * DDS;
* Модель (центр, распредеелнная)
  * центр — MQTT;
  * распределенная — CoAP, либо DDS (для гибкой настройки)
* Совместимость с АО
  * MQTT;
  * CoAP;
  * HTTP (если нет особых ограничений по ресурсам);
* Совместимость с ПО (инструменты разарботки, языки программирования)
  * MQTT;
  * AMQP;
  * HTTP (если нет особых ограничений по ресурсам);
* Арсенал реализаций (библиотеки, готовые решения)
  * MQTT;
* Сервисы
  * AMQP;
  * XMPP;
* Ограниченные ресурсы
  * MQTT + MQTT-SN;
  * CoAP;
  * DDS;
* Масштабирование
  * AMQP;
* Интеграция с доругими системами
  * MQTT;
  * HTTP (если нет особых ограничений по ресурсам);
* Стоимость
  * MQTT;
  * CoAP;
  * HTTP (если нет особых ограничений по ресурсам).